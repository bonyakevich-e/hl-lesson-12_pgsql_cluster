{
  "version": 4,
  "terraform_version": "1.10.0",
  "serial": 804,
  "lineage": "fc421cb8-e002-92ee-e466-c7ae7b2fc7f8",
  "outputs": {},
  "resources": [
    {
      "mode": "data",
      "type": "yandex_compute_image",
      "name": "ubuntu2404",
      "provider": "provider[\"registry.terraform.io/yandex-cloud/yandex\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "created_at": "2025-02-10T11:02:35Z",
            "description": "Ubuntu 24.04 OsLogin",
            "family": "ubuntu-2404-lts-oslogin",
            "folder_id": "standard-images",
            "hardware_generation": [
              {
                "generation2_features": [],
                "legacy_features": [
                  {
                    "pci_topology": "PCI_TOPOLOGY_V1"
                  }
                ]
              }
            ],
            "id": "fd85hkli5dp6as39ali4",
            "image_id": "fd85hkli5dp6as39ali4",
            "kms_key_id": null,
            "labels": {},
            "min_disk_size": 10,
            "name": "ubuntu-2404-lts-oslogin-v20250210",
            "os_type": "linux",
            "pooled": true,
            "product_ids": [
              "f2en8vggsflg7g3cgruu"
            ],
            "size": 5,
            "status": "ready"
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "yandex_vpc_network",
      "name": "default",
      "provider": "provider[\"registry.terraform.io/yandex-cloud/yandex\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "created_at": "2024-11-08T10:25:44Z",
            "default_security_group_id": "enph8nvndmf6tmo7urh2",
            "description": "Auto-created network",
            "folder_id": "b1ghnhdkga964vm8vfu6",
            "id": "enp014etv9tm4bcju6bq",
            "labels": {},
            "name": "default",
            "network_id": "enp014etv9tm4bcju6bq",
            "subnet_ids": [
              "e2lsbglh7iq9u6kfhn3o",
              "e9bri13lics7pf0i9vbq",
              "fl8c28ftrf5g7mdfkhl7"
            ]
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "managed",
      "type": "local_file",
      "name": "etcd_conf_etcd1",
      "provider": "provider[\"registry.terraform.io/hashicorp/local\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "content": "ETCD_NAME=\"etcd1\"\nETCD_LISTEN_PEER_URLS=\"http://10.16.0.26:2380\"\nETCD_LISTEN_CLIENT_URLS=\"http://10.16.0.26:2379,http://127.0.0.1:2379\"\nETCD_INITIAL_ADVERTISE_PEER_URLS=\"http://10.16.0.26:2380\"\nETCD_INITIAL_CLUSTER=\"etcd1=http://10.16.0.26:2380,etcd2=http://10.16.0.13:2380,etcd3=http://10.16.0.23:2380\"\nETCD_INITIAL_CLUSTER_STATE=\"new\"\nETCD_INITIAL_CLUSTER_TOKEN=\"etcd_cluster_1\"\nETCD_ADVERTISE_CLIENT_URLS=\"http://10.16.0.26:2379\"\nETCD_DATA_DIR=\"/var/lib/etcd\"\nETCD_ENABLE_V2=\"true\"",
            "content_base64": null,
            "content_base64sha256": "WlQvT7Av0uFFQbP1EUPKeMFr3Fepnj4U4YhWrcvA110=",
            "content_base64sha512": "VT1hxo5qqadB7Qc9WuWunhNahpjHj9Lq0mhIjdhWS7InA64UIm5tK/J9gDiAKXPT35t05RCzkEWTEaD71WR2rw==",
            "content_md5": "6691f328804662fdeba542cb042fbac9",
            "content_sha1": "812f89bc58a1d437c64522f4113d076b5c7fe408",
            "content_sha256": "5a542f4fb02fd2e14541b3f51143ca78c16bdc57a99e3e14e18856adcbc0d75d",
            "content_sha512": "553d61c68e6aa9a741ed073d5ae5ae9e135a8698c78fd2ead268488dd8564bb22703ae14226e6d2bf27d8038802973d3df9b74e510b390459311a0fbd56476af",
            "directory_permission": "0777",
            "file_permission": "0644",
            "filename": "templates/etcd/etcd.conf_etcd1",
            "id": "812f89bc58a1d437c64522f4113d076b5c7fe408",
            "sensitive_content": null,
            "source": null
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "sensitive_content"
              }
            ]
          ],
          "dependencies": [
            "data.yandex_compute_image.ubuntu2404",
            "data.yandex_vpc_network.default",
            "yandex_compute_instance.etcd",
            "yandex_vpc_subnet.subnet01"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "local_file",
      "name": "etcd_conf_etcd2",
      "provider": "provider[\"registry.terraform.io/hashicorp/local\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "content": "ETCD_NAME=\"etcd2\"\nETCD_LISTEN_PEER_URLS=\"http://10.16.0.13:2380\"\nETCD_LISTEN_CLIENT_URLS=\"http://10.16.0.13:2379,http://127.0.0.1:2379\"\nETCD_INITIAL_ADVERTISE_PEER_URLS=\"http://10.16.0.13:2380\"\nETCD_INITIAL_CLUSTER=\"etcd1=http://10.16.0.26:2380,etcd2=http://10.16.0.13:2380,etcd3=http://10.16.0.23:2380\"\nETCD_INITIAL_CLUSTER_STATE=\"new\"\nETCD_INITIAL_CLUSTER_TOKEN=\"etcd_cluster_1\"\nETCD_ADVERTISE_CLIENT_URLS=\"http://10.16.0.13:2379\"\nETCD_DATA_DIR=\"/var/lib/etcd\"\nETCD_ENABLE_V2=\"true\"",
            "content_base64": null,
            "content_base64sha256": "VLHUrOSySEvXUa+u2sXeV4QXOCvCcRvlg7G+aeKk2ik=",
            "content_base64sha512": "E/AwRP3Cnx7n7lxSBYcqibV05PHDmvaYUTp7kl0CUr0A5RiNCkOD9ht0wKS6OdGHs6022lsOGsa1/8QdCpuzCg==",
            "content_md5": "c0db55e872ea70c5b706bccb8383b9fe",
            "content_sha1": "e9f115cb45a0c69a92728a9b11606e0de03b43ce",
            "content_sha256": "54b1d4ace4b2484bd751afaedac5de578417382bc2711be583b1be69e2a4da29",
            "content_sha512": "13f03044fdc29f1ee7ee5c5205872a89b574e4f1c39af698513a7b925d0252bd00e5188d0a4383f61b74c0a4ba39d187b3ad36da5b0e1ac6b5ffc41d0a9bb30a",
            "directory_permission": "0777",
            "file_permission": "0644",
            "filename": "templates/etcd/etcd.conf_etcd2",
            "id": "e9f115cb45a0c69a92728a9b11606e0de03b43ce",
            "sensitive_content": null,
            "source": null
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "sensitive_content"
              }
            ]
          ],
          "dependencies": [
            "data.yandex_compute_image.ubuntu2404",
            "data.yandex_vpc_network.default",
            "yandex_compute_instance.etcd",
            "yandex_vpc_subnet.subnet01"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "local_file",
      "name": "etcd_conf_etcd3",
      "provider": "provider[\"registry.terraform.io/hashicorp/local\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "content": "ETCD_NAME=\"etcd3\"\nETCD_LISTEN_PEER_URLS=\"http://10.16.0.23:2380\"\nETCD_LISTEN_CLIENT_URLS=\"http://10.16.0.23:2379,http://127.0.0.1:2379\"\nETCD_INITIAL_ADVERTISE_PEER_URLS=\"http://10.16.0.23:2380\"\nETCD_INITIAL_CLUSTER=\"etcd1=http://10.16.0.26:2380,etcd2=http://10.16.0.13:2380,etcd3=http://10.16.0.23:2380\"\nETCD_INITIAL_CLUSTER_STATE=\"new\"\nETCD_INITIAL_CLUSTER_TOKEN=\"etcd_cluster_1\"\nETCD_ADVERTISE_CLIENT_URLS=\"http://10.16.0.23:2379\"\nETCD_DATA_DIR=\"/var/lib/etcd\"\nETCD_ENABLE_V2=\"true\"",
            "content_base64": null,
            "content_base64sha256": "vkx+HDu1bQM3N1uf9A7sQog/ozp8hy765AtgXQAosws=",
            "content_base64sha512": "wHvJ7/2OZUJkTxHQ+TXVDhQeW7WwQls07UyQABC2zcMc63ozbCtAO0Ik9bd5kWr9YYzYPKLa4pmOxpTKI2yuXA==",
            "content_md5": "80f2ad94b2c4642a06fb3da09511c9b2",
            "content_sha1": "e1d0f523f94b87347c3e26c199a9ffa27dbdeaea",
            "content_sha256": "be4c7e1c3bb56d0337375b9ff40eec42883fa33a7c872efae40b605d0028b30b",
            "content_sha512": "c07bc9effd8e6542644f11d0f935d50e141e5bb5b0425b34ed4c900010b6cdc31ceb7a336c2b403b4224f5b779916afd618cd83ca2dae2998ec694ca236cae5c",
            "directory_permission": "0777",
            "file_permission": "0644",
            "filename": "templates/etcd/etcd.conf_etcd3",
            "id": "e1d0f523f94b87347c3e26c199a9ffa27dbdeaea",
            "sensitive_content": null,
            "source": null
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "sensitive_content"
              }
            ]
          ],
          "dependencies": [
            "data.yandex_compute_image.ubuntu2404",
            "data.yandex_vpc_network.default",
            "yandex_compute_instance.etcd",
            "yandex_vpc_subnet.subnet01"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "local_file",
      "name": "inventory",
      "provider": "provider[\"registry.terraform.io/hashicorp/local\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "content": "[database]\ndatabase1 ansible_host=158.160.11.41 ansible_ssh_common_args='-o StrictHostKeyChecking=no'\ndatabase2 ansible_host=158.160.16.66 ansible_ssh_common_args='-o StrictHostKeyChecking=no'\n\n\n[backend]\nbackend1 ansible_host=51.250.106.104 ansible_ssh_common_args='-o StrictHostKeyChecking=no'\n\n[etcd]\netcd1 ansible_host=158.160.12.246 ansible_ssh_common_args='-o StrictHostKeyChecking=no'\netcd2 ansible_host=84.201.165.169 ansible_ssh_common_args='-o StrictHostKeyChecking=no'\netcd3 ansible_host=158.160.21.238 ansible_ssh_common_args='-o StrictHostKeyChecking=no'\n\n",
            "content_base64": null,
            "content_base64sha256": "np4d5cpN5udATsYKIaGK8l4bkpvM3rd1Y9WggM9ZphQ=",
            "content_base64sha512": "9ZiCqrzbSEm7ebbAxuMSwpLJCy7XYJUMkCIx7MwkoL9XxjDr0MNxaacqtq+02TlkIvcU0w2EhwlrIhEMKb5dtw==",
            "content_md5": "ab6bef632d240e0bdb6bf6d534bde4f0",
            "content_sha1": "429cb9277ad376016c07d90b05bc9bb6cb3c2a00",
            "content_sha256": "9e9e1de5ca4de6e7404ec60a21a18af25e1b929bccdeb77563d5a080cf59a614",
            "content_sha512": "f59882aabcdb4849bb79b6c0c6e312c292c90b2ed760950c902231eccc24a0bf57c630ebd0c37169a72ab6afb4d9396422f714d30d8487096b22110c29be5db7",
            "directory_permission": "0777",
            "file_permission": "0644",
            "filename": "./hosts",
            "id": "429cb9277ad376016c07d90b05bc9bb6cb3c2a00",
            "sensitive_content": null,
            "source": null
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "sensitive_content"
              }
            ]
          ],
          "dependencies": [
            "data.yandex_compute_image.ubuntu2404",
            "data.yandex_vpc_network.default",
            "yandex_compute_instance.backend",
            "yandex_compute_instance.database",
            "yandex_compute_instance.etcd",
            "yandex_vpc_subnet.subnet01"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "local_file",
      "name": "patroni_yml_database1",
      "provider": "provider[\"registry.terraform.io/hashicorp/local\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "content": "scope: postgres\nnamespace: /db/\nname: database1\n\nrestapi:\n  listen: 10.16.0.27:8008\n  connect_address: 10.16.0.27:8008\n\netcd:\n  hosts: 10.16.0.26:2379,10.16.0.13:2379,10.16.0.23:2379\n\nbootstrap:\n  dcs:\n    ttl: 30\n    loop_wait: 10\n    retry_timeout: 10\n    maximum_lag_on_failover: 1048576\n    postgresql:\n      use_pg_rewind: true\n      use_slots: true\n      parameters:\n\n  initdb:\n    - encoding: UTF8\n    - data-checksums\n\n  pg_hba:\n    - host replication replicator 127.0.0.1/32 md5\n    - host replication replicator 10.16.0.27/0 md5\n    - host replication replicator 10.16.0.38/0 md5\n    - host all all 0.0.0.0/0 md5\n\npostgresql:\n  listen: 10.16.0.27:5432\n  connect_address: 10.16.0.27:5432\n  data_dir: /var/lib/postgresql/16/main\n  bin_dir: /usr/lib/postgresql/16/bin\n  authentication:\n    replication:\n      username: replicator\n      password: OtusHL\n    superuser:\n      username: postgres\n      password: OtusHL",
            "content_base64": null,
            "content_base64sha256": "b7Mf7dE0BIM5DSKTjys72PDENZjSoBfOd1ceQzoH6zs=",
            "content_base64sha512": "hFmKUnMnucM2wVNNsGA7zxaQXPx1BlhmgAquCvYh9C6mt/kg4aozl3XmVF5mzYTUs7U7mo5dSG7xz/jzVjqXHg==",
            "content_md5": "79d51a5d2163ade7460377cb2945bcc0",
            "content_sha1": "5eb0592927645d499d7e4ce5dac0d4f9289221c3",
            "content_sha256": "6fb31fedd1340483390d22938f2b3bd8f0c43598d2a017ce77571e433a07eb3b",
            "content_sha512": "84598a527327b9c336c1534db0603bcf16905cfc75065866800aae0af621f42ea6b7f920e1aa339775e6545e66cd84d4b3b53b9a8e5d486ef1cff8f3563a971e",
            "directory_permission": "0777",
            "file_permission": "0644",
            "filename": "templates/database/patroni.yml_database1",
            "id": "5eb0592927645d499d7e4ce5dac0d4f9289221c3",
            "sensitive_content": null,
            "source": null
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "sensitive_content"
              }
            ]
          ],
          "dependencies": [
            "data.yandex_compute_image.ubuntu2404",
            "data.yandex_vpc_network.default",
            "yandex_compute_instance.database",
            "yandex_compute_instance.etcd",
            "yandex_vpc_subnet.subnet01"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "local_file",
      "name": "patroni_yml_database2",
      "provider": "provider[\"registry.terraform.io/hashicorp/local\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "content": "scope: postgres\nnamespace: /db/\nname: database2\n\nrestapi:\n  listen: 10.16.0.38:8008\n  connect_address: 10.16.0.38:8008\n\netcd:\n  hosts: 10.16.0.26:2379,10.16.0.13:2379,10.16.0.23:2379\n\nbootstrap:\n  dcs:\n    ttl: 30\n    loop_wait: 10\n    retry_timeout: 10\n    maximum_lag_on_failover: 1048576\n    postgresql:\n      use_pg_rewind: true\n      use_slots: true\n      parameters:\n\n  initdb:\n    - encoding: UTF8\n    - data-checksums\n\n  pg_hba:\n    - host replication replicator 127.0.0.1/32 md5\n    - host replication replicator 10.16.0.27/0 md5\n    - host replication replicator 10.16.0.38/0 md5\n    - host all all 0.0.0.0/0 md5\n\npostgresql:\n  listen: 10.16.0.38:5432\n  connect_address: 10.16.0.38:5432\n  data_dir: /var/lib/postgresql/16/main\n  bin_dir: /usr/lib/postgresql/16/bin\n  authentication:\n    replication:\n      username: replicator\n      password: OtusHL\n    superuser:\n      username: postgres\n      password: OtusHL",
            "content_base64": null,
            "content_base64sha256": "BGS/H70JojkchJH0ew86tEffycpb2uYDvCVjcLTvbQQ=",
            "content_base64sha512": "TNmaY/yJhjm/2xiN9DOq5t2vCZgtQyIqKaEEn8iUEibnARowwac1GChTVQsk6kefjVMJFaMhV4/oFXVftM8Ufg==",
            "content_md5": "5a2a47a95a3d3b01be915aad591da674",
            "content_sha1": "26254bb31c114709bfe2ef568d8564c45dab081a",
            "content_sha256": "0464bf1fbd09a2391c8491f47b0f3ab447dfc9ca5bdae603bc256370b4ef6d04",
            "content_sha512": "4cd99a63fc898639bfdb188df433aae6ddaf09982d43222a29a1049fc8941226e7011a30c1a735182853550b24ea479f8d530915a321578fe815755fb4cf147e",
            "directory_permission": "0777",
            "file_permission": "0644",
            "filename": "templates/database/patroni.yml_database2",
            "id": "26254bb31c114709bfe2ef568d8564c45dab081a",
            "sensitive_content": null,
            "source": null
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "sensitive_content"
              }
            ]
          ],
          "dependencies": [
            "data.yandex_compute_image.ubuntu2404",
            "data.yandex_vpc_network.default",
            "yandex_compute_instance.database",
            "yandex_compute_instance.etcd",
            "yandex_vpc_subnet.subnet01"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "local_file",
      "name": "playbook_yml",
      "provider": "provider[\"registry.terraform.io/hashicorp/local\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "content": "---\n- hosts: all\n  tags: initial settings\n  remote_user: ubuntu\n  become: yes\n  gather_facts: no\n  tasks:\n  \n# ждем пока виртуальные машины придут в себя. иначе могу быть баги с утановкой пакетов  \n  - name: Pause for 2 minutes\n    ansible.builtin.pause:\n      minutes: 2\n\n  - name: Wait for system to become reachable\n    ansible.builtin.wait_for_connection:\n\n  - name: Gather facts manually\n    ansible.builtin.setup:\n  \n  - name: Set timezone\n    timezone:\n      name: Europe/Moscow\n  \n  - name: Add entries to hosts\n    copy:\n      dest: /etc/hosts\n      content: \"#\\n\n127.0.0.1\tlocalhost\\n\n10.16.0.33\tbackend1\\n\n10.16.0.27\tdatabase1\\n\n10.16.0.38\tdatabase2\\n\n\"\n\n# =============================== setup etcd =================================\n\n- hosts: etcd\n  tags: setup etcd\n  remote_user: ubuntu\n  become: yes\n  tasks: \n\n  - name: Update apt cache\n    tags: update apt cache\n    ansible.builtin.apt: \n      update_cache: yes\n  \n  - name: Install etcd\n    tags: install etcd\n    ansible.builtin.unarchive:\n      src: https://cloud.baltbereg.com/index.php/s/nTHrb3ABA9YbxtS/download/etcd-v3.5.18-linux-amd64.tar.gz\n      dest: /tmp/\n      remote_src: yes\n\n  - name: Copy etcd binaries to /usr/local/bin\n    ansible.builtin.copy:\n      src: \"/tmp/etcd-v3.5.18-linux-amd64/{{ item }}\"\n      dest: /usr/local/bin\n      remote_src: yes\n      mode: '0755'\n    with_items:\n      - etcd\n      - etcdctl\n      - etcdutl\n      \n  - name: Create etcd system group\n    tags: create etcd system group\n    ansible.builtin.group:\n      name: etcd\n      state: present\n      system: yes\n\n  - name: Create etcd user\n    tags: create etcd user\n    ansible.builtin.user:\n      name: etcd\n      group: etcd\n      system: yes\n      shell: /sbin/nologin\n\n  - name: Create /var/lib/etcd/\n    tags: create /var/lib/etcd/\n    ansible.builtin.file:\n      path: /var/lib/etcd/\n      state: directory\n      owner: etcd\n      group: etcd\n      mode: '0755'\n\n  - name: Create /etc/etcd\n    ansible.builtin.file:\n      path: /etc/etcd\n      state: directory  \n\n  - name: Copy systemd unit etcd.service\n    ansible.builtin.copy:\n      src: templates/etcd/etcd.service\n      dest: /etc/systemd/system/etcd.service\n\n  - name: Copy etcd config\n    tags: copy etcd config\n    ansible.builtin.copy:\n      src: templates/etcd/etcd.conf_{{ inventory_hostname }}\n      dest: /etc/etcd/etcd.conf\n\n  - name: Start etcd\n    tags: start etcd\n    ansible.builtin.service:\n      name: etcd\n      state: restarted\n      enabled: yes\n\n# ============================ setup database ===================\n\n- hosts: database\n  tags: setup database\n  remote_user: ubuntu\n  become: yes\n  tasks:\n\n  - name: Generate an OpenSSH keypair with the default values (4096 bits, rsa)\n    community.crypto.openssh_keypair:\n      path: /root/.ssh/id_rsa\n\n  - name: Install additional packages\n    ansible.builtin.apt:\n      name: \"{{ item }}\"\n      state: present\n      update_cache: true\n    with_items:\n      - python3-pip\n      - python3-dev\n      - libpq-dev\n\n  - name: Install PostgreSQL\n    ansible.builtin.apt: \n      name: \"{{ item }}\"\n      state: present\n      update_cache: yes\n    with_items:\n      - postgresql\n      - postgresql-contrib\n      - postgresql-client-16\n      - postgresql-server-dev-16\n\n  - name: Install Patroni\n    ansible.builtin.pip: \n      name: \"{{ item }}\"\n      break_system_packages: true\n    with_items:\n      - patroni\n      - python-etcd\n      - psycopg2\n      \n  - name: Disable postgresql autorun (it will be made by patroni)\n    tags: disable postgresql\n    ansible.builtin.service:\n      name: postgresql\n      state: stopped\n      enabled: no\n  \n  - name: Remove initial config, that was created by postgresql\n    tags: remove initial config\n    ansible.builtin.file:\n      path: /var/lib/postgresql/16/main\n      state: absent\n\n  - name: Create patroni config directory\n    tags: create patroni config directory\n    ansible.builtin.file:\n      path: /etc/patroni\n      state: directory\n      owner: postgres\n      group: postgres\n      mode: '0755'\n\n  - name: Copy patroni service file\n    tags: copy patroni service file\n    ansible.builtin.copy:\n      src: templates/database/patroni.service\n      dest: /etc/systemd/system/patroni.service  \n\n  - name: Copy patroni configuration\n    tags: copy patroni config\n    ansible.builtin.copy:\n      src: templates/database/patroni.yml_{{inventory_hostname}}\n      dest: /etc/patroni/patroni.yml\n      owner: postgres\n      group: postgres\n      mode: '0755'\n\n  - name: Start and enable patroni\n    tags: start patroni\n    ansible.builtin.service:\n      name: patroni\n      state: started\n      enabled: yes\n\n# =============================== setup backend servers ======================\n\n- hosts: backend\n  tags: setup backends\n  remote_user: ubuntu\n  become: yes\n  tasks:\n  \n  - name: Install prerequisites\n    apt:\n      name: \"{{ item }}\"\n      state: latest\n      update_cache: true\n    with_items:\n      - apache2\n      - libapache2-mod-php\n      - php-gd\n      - php-mysql\n      - php-curl\n      - php-mbstring\n      - php-intl\n      - php-gmp\n      - php-bcmath\n      - php-xml\n      - php-imagick\n      - php-zip\n      - php-pgsql\n      - haproxy\n      - postgresql-client-16\n      - bzip2\n    notify: restart apache2\n\n  - name: Enable recommended apache modules\n    tags: enable_apache2_modules_web1\n    community.general.apache2_module:\n      state: present\n      name: \"{{ item }}\" \n    with_items:\n      - rewrite\n      - headers\n      - env\n      - dir\n      - mime\n    notify: restart apache2\n  \n  - name: enable apache2 service\n    ansible.builtin.service:\n      name: apache2\n      enabled: true\n\n  - name: modify apache2.conf\n    ansible.builtin.template:\n      src: templates/apache2.conf\n      dest: /etc/apache2/apache2.conf\n    notify:\n      - restart apache2\n\n  - name: add vhost for nextcloud\n    ansible.builtin.template:\n      src: nextcloud.conf.j2\n      dest: /etc/apache2/sites-available/nextcloud.conf\n    notify:\n      - enable nextcloud vhost\n      - restart apache2\n\n  - name: Copy haproxy config\n    tags: copy haproxy config\n    ansible.builtin.copy:\n      src: templates/backend/haproxy.cfg\n      dest: /etc/haproxy/haproxy.cfg\n\n  - name: Start haproxy\n    tags: start haproxy\n    ansible.builtin.service:\n      name: haproxy\n      state: restarted\n      enabled: yes  \n\n  handlers:\n  - name: enable nextcloud vhost\n    ansible.builtin.shell: /usr/sbin/a2ensite nextcloud.conf\n\n  - name: restart apache2\n    ansible.builtin.service:\n      name: apache2\n      state: restarted\n\n# =============================== setup Nextcloud  ======================\n\n- hosts: backend\n  tags: setup nextcloud\n  remote_user: ubuntu\n  become: yes\n  tasks:\n\n  - name: Extact nextcloud-30.0.4.tar.bz2 into storage directory\n    ansible.builtin.unarchive:\n      src: https://cloud.baltbereg.com/index.php/s/K7gXPYBEpc9Ygkw/download/nextcloud-30.0.4.tar.bz2\n      dest: /var/www\n      remote_src: yes\n\n  - name: Change nextcloud files' owner\n    ansible.builtin.file:\n      path: /var/www/nextcloud\n      state: directory\n      recurse: yes\n      owner: www-data\n      group: www-data\n\n  - name: Copy .sql file\n    tags: copy sql file\n    ansible.builtin.copy:\n      src: templates/database/nextcloud.sql\n      dest: /tmp\n\n  - name: Execute .sql file\n    tags: execute sql file\n    ansible.builtin.shell: 'PGPASSWORD=OtusHL psql -Upostgres -hlocalhost -p5000 \u003c /tmp/nextcloud.sql' \n\n  - name: make initial configuration of Nextcloud\n    command: sudo -u www-data php occ  maintenance:install --database-host='localhost:5000' --database='pgsql' --database-name='nextcloud' --database-user='nextcloud' --database-pass='OtusHL' --admin-user='admin' --admin-pass='OtusHL'\n    args: \n      chdir: /var/www/nextcloud\n\n  - name: add trusted domains to nextcloud config.php\n    tags: add trusted domains\n    ansible.builtin.lineinfile:\n      path: /var/www/nextcloud/config/config.php\n      insertafter: 0 =\u003e 'localhost',\n      line: \"    1 =\u003e 'otus.highload.com',\"\n\n",
            "content_base64": null,
            "content_base64sha256": "0/ARxZQI/MOK7iukOE/gt815pUW0NiA4UVtJPLvd1nE=",
            "content_base64sha512": "MFcpwA+Mcn7FLbEOHXElfoIpVfsV0Kdq39lQye2XIeAHx8AuZGDvpMTeDKIsfZW7sccBk6FbKDAcqhYUPv5MBQ==",
            "content_md5": "af9e21338c083e094a5e88736025fdd1",
            "content_sha1": "e2126a81dfe6be4c3b2ad22ddd634fdc9047ab86",
            "content_sha256": "d3f011c59408fcc38aee2ba4384fe0b7cd79a545b4362038515b493cbbddd671",
            "content_sha512": "305729c00f8c727ec52db10e1d71257e822955fb15d0a76adfd950c9ed9721e007c7c02e6460efa4c4de0ca22c7d95bbb1c70193a15b28301caa16143efe4c05",
            "directory_permission": "0777",
            "file_permission": "0644",
            "filename": "./playbook.yml",
            "id": "e2126a81dfe6be4c3b2ad22ddd634fdc9047ab86",
            "sensitive_content": null,
            "source": null
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "sensitive_content"
              }
            ]
          ],
          "dependencies": [
            "data.yandex_compute_image.ubuntu2404",
            "data.yandex_vpc_network.default",
            "yandex_compute_instance.backend",
            "yandex_compute_instance.database",
            "yandex_compute_instance.etcd",
            "yandex_vpc_subnet.subnet01"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "yandex_compute_disk",
      "name": "shared_disk",
      "provider": "provider[\"registry.terraform.io/yandex-cloud/yandex\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "allow_recreate": null,
            "block_size": 4096,
            "created_at": "2025-02-12T16:24:37Z",
            "description": "",
            "disk_placement_policy": [
              {
                "disk_placement_group_id": ""
              }
            ],
            "folder_id": "b1ghnhdkga964vm8vfu6",
            "hardware_generation": [
              {
                "generation2_features": [],
                "legacy_features": [
                  {
                    "pci_topology": "PCI_TOPOLOGY_V1"
                  }
                ]
              }
            ],
            "id": "epd0nm75rgg223s3m36o",
            "image_id": "",
            "kms_key_id": null,
            "labels": null,
            "name": "shared-disk",
            "product_ids": [],
            "size": 5,
            "snapshot_id": "",
            "status": "ready",
            "timeouts": null,
            "type": "network-hdd",
            "zone": "ru-central1-b"
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozMDAwMDAwMDAwMDAsImRlbGV0ZSI6MzAwMDAwMDAwMDAwLCJ1cGRhdGUiOjMwMDAwMDAwMDAwMH19"
        }
      ]
    },
    {
      "mode": "managed",
      "type": "yandex_compute_instance",
      "name": "backend",
      "provider": "provider[\"registry.terraform.io/yandex-cloud/yandex\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 1,
          "attributes": {
            "allow_recreate": null,
            "allow_stopping_for_update": null,
            "boot_disk": [
              {
                "auto_delete": true,
                "device_name": "epd2mp77cfppln1nm2ba",
                "disk_id": "epd2mp77cfppln1nm2ba",
                "initialize_params": [
                  {
                    "block_size": 4096,
                    "description": "",
                    "image_id": "fd85hkli5dp6as39ali4",
                    "kms_key_id": "",
                    "name": "boot-disk-backend1",
                    "size": 10,
                    "snapshot_id": "",
                    "type": "network-hdd"
                  }
                ],
                "mode": "READ_WRITE"
              }
            ],
            "created_at": "2025-02-12T16:24:38Z",
            "description": "",
            "filesystem": [],
            "folder_id": "b1ghnhdkga964vm8vfu6",
            "fqdn": "backend1.ru-central1.internal",
            "gpu_cluster_id": "",
            "hardware_generation": [
              {
                "generation2_features": [],
                "legacy_features": [
                  {
                    "pci_topology": "PCI_TOPOLOGY_V1"
                  }
                ]
              }
            ],
            "hostname": "backend1",
            "id": "epd704fkbohkbalar64o",
            "labels": null,
            "local_disk": [],
            "maintenance_grace_period": "",
            "maintenance_policy": null,
            "metadata": {
              "ssh-keys": "ubuntu:ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIFsv6OblDNKcWCXVFwd7wFacShcXDYt/mqBrPConqp8f itbn@LearningMachine1\n"
            },
            "metadata_options": [
              {
                "aws_v1_http_endpoint": 1,
                "aws_v1_http_token": 2,
                "gce_http_endpoint": 1,
                "gce_http_token": 1
              }
            ],
            "name": "backend1",
            "network_acceleration_type": "standard",
            "network_interface": [
              {
                "dns_record": [],
                "index": 0,
                "ip_address": "10.16.0.33",
                "ipv4": true,
                "ipv6": false,
                "ipv6_address": "",
                "ipv6_dns_record": [],
                "mac_address": "d0:0d:70:11:f4:5e",
                "nat": true,
                "nat_dns_record": [],
                "nat_ip_address": "51.250.106.104",
                "nat_ip_version": "IPV4",
                "security_group_ids": [],
                "subnet_id": "e2lcu2k3oot8e2cs3nap"
              }
            ],
            "placement_policy": [
              {
                "host_affinity_rules": [],
                "placement_group_id": "",
                "placement_group_partition": 0
              }
            ],
            "platform_id": "standard-v1",
            "resources": [
              {
                "core_fraction": 100,
                "cores": 2,
                "gpus": 0,
                "memory": 2
              }
            ],
            "scheduling_policy": [
              {
                "preemptible": false
              }
            ],
            "secondary_disk": [],
            "service_account_id": "",
            "status": "running",
            "timeouts": null,
            "zone": "ru-central1-b"
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozMDAwMDAwMDAwMDAsImRlbGV0ZSI6MzAwMDAwMDAwMDAwLCJ1cGRhdGUiOjMwMDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiMSJ9",
          "dependencies": [
            "data.yandex_compute_image.ubuntu2404",
            "data.yandex_vpc_network.default",
            "yandex_vpc_subnet.subnet01"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "yandex_compute_instance",
      "name": "database",
      "provider": "provider[\"registry.terraform.io/yandex-cloud/yandex\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 1,
          "attributes": {
            "allow_recreate": null,
            "allow_stopping_for_update": null,
            "boot_disk": [
              {
                "auto_delete": true,
                "device_name": "epdc51n37ks49tc92t9b",
                "disk_id": "epdc51n37ks49tc92t9b",
                "initialize_params": [
                  {
                    "block_size": 4096,
                    "description": "",
                    "image_id": "fd85hkli5dp6as39ali4",
                    "kms_key_id": "",
                    "name": "boot-disk-database1",
                    "size": 10,
                    "snapshot_id": "",
                    "type": "network-hdd"
                  }
                ],
                "mode": "READ_WRITE"
              }
            ],
            "created_at": "2025-02-12T16:24:38Z",
            "description": "",
            "filesystem": [],
            "folder_id": "b1ghnhdkga964vm8vfu6",
            "fqdn": "database1.ru-central1.internal",
            "gpu_cluster_id": "",
            "hardware_generation": [
              {
                "generation2_features": [],
                "legacy_features": [
                  {
                    "pci_topology": "PCI_TOPOLOGY_V1"
                  }
                ]
              }
            ],
            "hostname": "database1",
            "id": "epdabri6phjpbp57mhfh",
            "labels": null,
            "local_disk": [],
            "maintenance_grace_period": "",
            "maintenance_policy": null,
            "metadata": {
              "ssh-keys": "ubuntu:ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIFsv6OblDNKcWCXVFwd7wFacShcXDYt/mqBrPConqp8f itbn@LearningMachine1\n"
            },
            "metadata_options": [
              {
                "aws_v1_http_endpoint": 1,
                "aws_v1_http_token": 2,
                "gce_http_endpoint": 1,
                "gce_http_token": 1
              }
            ],
            "name": "database1",
            "network_acceleration_type": "standard",
            "network_interface": [
              {
                "dns_record": [],
                "index": 0,
                "ip_address": "10.16.0.27",
                "ipv4": true,
                "ipv6": false,
                "ipv6_address": "",
                "ipv6_dns_record": [],
                "mac_address": "d0:0d:a5:ee:46:cc",
                "nat": true,
                "nat_dns_record": [],
                "nat_ip_address": "158.160.11.41",
                "nat_ip_version": "IPV4",
                "security_group_ids": [],
                "subnet_id": "e2lcu2k3oot8e2cs3nap"
              }
            ],
            "placement_policy": [
              {
                "host_affinity_rules": [],
                "placement_group_id": "",
                "placement_group_partition": 0
              }
            ],
            "platform_id": "standard-v1",
            "resources": [
              {
                "core_fraction": 100,
                "cores": 2,
                "gpus": 0,
                "memory": 2
              }
            ],
            "scheduling_policy": [
              {
                "preemptible": false
              }
            ],
            "secondary_disk": [],
            "service_account_id": "",
            "status": "running",
            "timeouts": null,
            "zone": "ru-central1-b"
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozMDAwMDAwMDAwMDAsImRlbGV0ZSI6MzAwMDAwMDAwMDAwLCJ1cGRhdGUiOjMwMDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiMSJ9",
          "dependencies": [
            "data.yandex_compute_image.ubuntu2404",
            "data.yandex_vpc_network.default",
            "yandex_vpc_subnet.subnet01"
          ]
        },
        {
          "index_key": 1,
          "schema_version": 1,
          "attributes": {
            "allow_recreate": null,
            "allow_stopping_for_update": null,
            "boot_disk": [
              {
                "auto_delete": true,
                "device_name": "epdvdl1or0cs1pagh6q0",
                "disk_id": "epdvdl1or0cs1pagh6q0",
                "initialize_params": [
                  {
                    "block_size": 4096,
                    "description": "",
                    "image_id": "fd85hkli5dp6as39ali4",
                    "kms_key_id": "",
                    "name": "boot-disk-database2",
                    "size": 10,
                    "snapshot_id": "",
                    "type": "network-hdd"
                  }
                ],
                "mode": "READ_WRITE"
              }
            ],
            "created_at": "2025-02-12T16:24:38Z",
            "description": "",
            "filesystem": [],
            "folder_id": "b1ghnhdkga964vm8vfu6",
            "fqdn": "database2.ru-central1.internal",
            "gpu_cluster_id": "",
            "hardware_generation": [
              {
                "generation2_features": [],
                "legacy_features": [
                  {
                    "pci_topology": "PCI_TOPOLOGY_V1"
                  }
                ]
              }
            ],
            "hostname": "database2",
            "id": "epdmh3m3od2pq63msmn0",
            "labels": null,
            "local_disk": [],
            "maintenance_grace_period": "",
            "maintenance_policy": null,
            "metadata": {
              "ssh-keys": "ubuntu:ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIFsv6OblDNKcWCXVFwd7wFacShcXDYt/mqBrPConqp8f itbn@LearningMachine1\n"
            },
            "metadata_options": [
              {
                "aws_v1_http_endpoint": 1,
                "aws_v1_http_token": 2,
                "gce_http_endpoint": 1,
                "gce_http_token": 1
              }
            ],
            "name": "database2",
            "network_acceleration_type": "standard",
            "network_interface": [
              {
                "dns_record": [],
                "index": 0,
                "ip_address": "10.16.0.38",
                "ipv4": true,
                "ipv6": false,
                "ipv6_address": "",
                "ipv6_dns_record": [],
                "mac_address": "d0:0d:16:88:ec:3c",
                "nat": true,
                "nat_dns_record": [],
                "nat_ip_address": "158.160.16.66",
                "nat_ip_version": "IPV4",
                "security_group_ids": [],
                "subnet_id": "e2lcu2k3oot8e2cs3nap"
              }
            ],
            "placement_policy": [
              {
                "host_affinity_rules": [],
                "placement_group_id": "",
                "placement_group_partition": 0
              }
            ],
            "platform_id": "standard-v1",
            "resources": [
              {
                "core_fraction": 100,
                "cores": 2,
                "gpus": 0,
                "memory": 2
              }
            ],
            "scheduling_policy": [
              {
                "preemptible": false
              }
            ],
            "secondary_disk": [],
            "service_account_id": "",
            "status": "running",
            "timeouts": null,
            "zone": "ru-central1-b"
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozMDAwMDAwMDAwMDAsImRlbGV0ZSI6MzAwMDAwMDAwMDAwLCJ1cGRhdGUiOjMwMDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiMSJ9",
          "dependencies": [
            "data.yandex_compute_image.ubuntu2404",
            "data.yandex_vpc_network.default",
            "yandex_vpc_subnet.subnet01"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "yandex_compute_instance",
      "name": "etcd",
      "provider": "provider[\"registry.terraform.io/yandex-cloud/yandex\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 1,
          "attributes": {
            "allow_recreate": null,
            "allow_stopping_for_update": null,
            "boot_disk": [
              {
                "auto_delete": true,
                "device_name": "epdreuhtv0td41vnq5je",
                "disk_id": "epdreuhtv0td41vnq5je",
                "initialize_params": [
                  {
                    "block_size": 4096,
                    "description": "",
                    "image_id": "fd85hkli5dp6as39ali4",
                    "kms_key_id": "",
                    "name": "boot-disk-etcd1",
                    "size": 10,
                    "snapshot_id": "",
                    "type": "network-hdd"
                  }
                ],
                "mode": "READ_WRITE"
              }
            ],
            "created_at": "2025-02-12T16:24:38Z",
            "description": "",
            "filesystem": [],
            "folder_id": "b1ghnhdkga964vm8vfu6",
            "fqdn": "etcd1.ru-central1.internal",
            "gpu_cluster_id": "",
            "hardware_generation": [
              {
                "generation2_features": [],
                "legacy_features": [
                  {
                    "pci_topology": "PCI_TOPOLOGY_V1"
                  }
                ]
              }
            ],
            "hostname": "etcd1",
            "id": "epdo6f4dp3psnoreh6o6",
            "labels": null,
            "local_disk": [],
            "maintenance_grace_period": "",
            "maintenance_policy": null,
            "metadata": {
              "ssh-keys": "ubuntu:ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIFsv6OblDNKcWCXVFwd7wFacShcXDYt/mqBrPConqp8f itbn@LearningMachine1\n"
            },
            "metadata_options": [
              {
                "aws_v1_http_endpoint": 1,
                "aws_v1_http_token": 2,
                "gce_http_endpoint": 1,
                "gce_http_token": 1
              }
            ],
            "name": "etcd1",
            "network_acceleration_type": "standard",
            "network_interface": [
              {
                "dns_record": [],
                "index": 0,
                "ip_address": "10.16.0.26",
                "ipv4": true,
                "ipv6": false,
                "ipv6_address": "",
                "ipv6_dns_record": [],
                "mac_address": "d0:0d:18:33:c8:dc",
                "nat": true,
                "nat_dns_record": [],
                "nat_ip_address": "158.160.12.246",
                "nat_ip_version": "IPV4",
                "security_group_ids": [],
                "subnet_id": "e2lcu2k3oot8e2cs3nap"
              }
            ],
            "placement_policy": [
              {
                "host_affinity_rules": [],
                "placement_group_id": "",
                "placement_group_partition": 0
              }
            ],
            "platform_id": "standard-v1",
            "resources": [
              {
                "core_fraction": 100,
                "cores": 2,
                "gpus": 0,
                "memory": 2
              }
            ],
            "scheduling_policy": [
              {
                "preemptible": false
              }
            ],
            "secondary_disk": [],
            "service_account_id": "",
            "status": "running",
            "timeouts": null,
            "zone": "ru-central1-b"
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozMDAwMDAwMDAwMDAsImRlbGV0ZSI6MzAwMDAwMDAwMDAwLCJ1cGRhdGUiOjMwMDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiMSJ9",
          "dependencies": [
            "data.yandex_compute_image.ubuntu2404",
            "data.yandex_vpc_network.default",
            "yandex_vpc_subnet.subnet01"
          ]
        },
        {
          "index_key": 1,
          "schema_version": 1,
          "attributes": {
            "allow_recreate": null,
            "allow_stopping_for_update": null,
            "boot_disk": [
              {
                "auto_delete": true,
                "device_name": "epdekl6lmdqv5uer4038",
                "disk_id": "epdekl6lmdqv5uer4038",
                "initialize_params": [
                  {
                    "block_size": 4096,
                    "description": "",
                    "image_id": "fd85hkli5dp6as39ali4",
                    "kms_key_id": "",
                    "name": "boot-disk-etcd2",
                    "size": 10,
                    "snapshot_id": "",
                    "type": "network-hdd"
                  }
                ],
                "mode": "READ_WRITE"
              }
            ],
            "created_at": "2025-02-12T16:24:38Z",
            "description": "",
            "filesystem": [],
            "folder_id": "b1ghnhdkga964vm8vfu6",
            "fqdn": "etcd2.ru-central1.internal",
            "gpu_cluster_id": "",
            "hardware_generation": [
              {
                "generation2_features": [],
                "legacy_features": [
                  {
                    "pci_topology": "PCI_TOPOLOGY_V1"
                  }
                ]
              }
            ],
            "hostname": "etcd2",
            "id": "epdimi8hnsv0omhuvsdj",
            "labels": null,
            "local_disk": [],
            "maintenance_grace_period": "",
            "maintenance_policy": null,
            "metadata": {
              "ssh-keys": "ubuntu:ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIFsv6OblDNKcWCXVFwd7wFacShcXDYt/mqBrPConqp8f itbn@LearningMachine1\n"
            },
            "metadata_options": [
              {
                "aws_v1_http_endpoint": 1,
                "aws_v1_http_token": 2,
                "gce_http_endpoint": 1,
                "gce_http_token": 1
              }
            ],
            "name": "etcd2",
            "network_acceleration_type": "standard",
            "network_interface": [
              {
                "dns_record": [],
                "index": 0,
                "ip_address": "10.16.0.13",
                "ipv4": true,
                "ipv6": false,
                "ipv6_address": "",
                "ipv6_dns_record": [],
                "mac_address": "d0:0d:12:b4:91:1b",
                "nat": true,
                "nat_dns_record": [],
                "nat_ip_address": "84.201.165.169",
                "nat_ip_version": "IPV4",
                "security_group_ids": [],
                "subnet_id": "e2lcu2k3oot8e2cs3nap"
              }
            ],
            "placement_policy": [
              {
                "host_affinity_rules": [],
                "placement_group_id": "",
                "placement_group_partition": 0
              }
            ],
            "platform_id": "standard-v1",
            "resources": [
              {
                "core_fraction": 100,
                "cores": 2,
                "gpus": 0,
                "memory": 2
              }
            ],
            "scheduling_policy": [
              {
                "preemptible": false
              }
            ],
            "secondary_disk": [],
            "service_account_id": "",
            "status": "running",
            "timeouts": null,
            "zone": "ru-central1-b"
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozMDAwMDAwMDAwMDAsImRlbGV0ZSI6MzAwMDAwMDAwMDAwLCJ1cGRhdGUiOjMwMDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiMSJ9",
          "dependencies": [
            "data.yandex_compute_image.ubuntu2404",
            "data.yandex_vpc_network.default",
            "yandex_vpc_subnet.subnet01"
          ]
        },
        {
          "index_key": 2,
          "schema_version": 1,
          "attributes": {
            "allow_recreate": null,
            "allow_stopping_for_update": null,
            "boot_disk": [
              {
                "auto_delete": true,
                "device_name": "epdp91vu17abs04n7ub2",
                "disk_id": "epdp91vu17abs04n7ub2",
                "initialize_params": [
                  {
                    "block_size": 4096,
                    "description": "",
                    "image_id": "fd85hkli5dp6as39ali4",
                    "kms_key_id": "",
                    "name": "boot-disk-etcd3",
                    "size": 10,
                    "snapshot_id": "",
                    "type": "network-hdd"
                  }
                ],
                "mode": "READ_WRITE"
              }
            ],
            "created_at": "2025-02-12T16:24:38Z",
            "description": "",
            "filesystem": [],
            "folder_id": "b1ghnhdkga964vm8vfu6",
            "fqdn": "etcd3.ru-central1.internal",
            "gpu_cluster_id": "",
            "hardware_generation": [
              {
                "generation2_features": [],
                "legacy_features": [
                  {
                    "pci_topology": "PCI_TOPOLOGY_V1"
                  }
                ]
              }
            ],
            "hostname": "etcd3",
            "id": "epd7p0j7i0vo6m4puvdn",
            "labels": null,
            "local_disk": [],
            "maintenance_grace_period": "",
            "maintenance_policy": null,
            "metadata": {
              "ssh-keys": "ubuntu:ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIFsv6OblDNKcWCXVFwd7wFacShcXDYt/mqBrPConqp8f itbn@LearningMachine1\n"
            },
            "metadata_options": [
              {
                "aws_v1_http_endpoint": 1,
                "aws_v1_http_token": 2,
                "gce_http_endpoint": 1,
                "gce_http_token": 1
              }
            ],
            "name": "etcd3",
            "network_acceleration_type": "standard",
            "network_interface": [
              {
                "dns_record": [],
                "index": 0,
                "ip_address": "10.16.0.23",
                "ipv4": true,
                "ipv6": false,
                "ipv6_address": "",
                "ipv6_dns_record": [],
                "mac_address": "d0:0d:7c:82:67:90",
                "nat": true,
                "nat_dns_record": [],
                "nat_ip_address": "158.160.21.238",
                "nat_ip_version": "IPV4",
                "security_group_ids": [],
                "subnet_id": "e2lcu2k3oot8e2cs3nap"
              }
            ],
            "placement_policy": [
              {
                "host_affinity_rules": [],
                "placement_group_id": "",
                "placement_group_partition": 0
              }
            ],
            "platform_id": "standard-v1",
            "resources": [
              {
                "core_fraction": 100,
                "cores": 2,
                "gpus": 0,
                "memory": 2
              }
            ],
            "scheduling_policy": [
              {
                "preemptible": false
              }
            ],
            "secondary_disk": [],
            "service_account_id": "",
            "status": "running",
            "timeouts": null,
            "zone": "ru-central1-b"
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozMDAwMDAwMDAwMDAsImRlbGV0ZSI6MzAwMDAwMDAwMDAwLCJ1cGRhdGUiOjMwMDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiMSJ9",
          "dependencies": [
            "data.yandex_compute_image.ubuntu2404",
            "data.yandex_vpc_network.default",
            "yandex_vpc_subnet.subnet01"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "yandex_vpc_subnet",
      "name": "subnet01",
      "provider": "provider[\"registry.terraform.io/yandex-cloud/yandex\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "created_at": "2025-02-12T16:24:37Z",
            "description": "",
            "dhcp_options": [],
            "folder_id": "b1ghnhdkga964vm8vfu6",
            "id": "e2lcu2k3oot8e2cs3nap",
            "labels": {},
            "name": "subnet01",
            "network_id": "enp014etv9tm4bcju6bq",
            "route_table_id": "",
            "timeouts": null,
            "v4_cidr_blocks": [
              "10.16.0.0/24"
            ],
            "v6_cidr_blocks": [],
            "zone": "ru-central1-b"
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAsImRlbGV0ZSI6MTgwMDAwMDAwMDAwLCJ1cGRhdGUiOjE4MDAwMDAwMDAwMH19",
          "dependencies": [
            "data.yandex_vpc_network.default"
          ]
        }
      ]
    }
  ],
  "check_results": null
}
